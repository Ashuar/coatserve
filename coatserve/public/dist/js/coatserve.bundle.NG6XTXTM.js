(()=>{frappe.provide("erpnext");frappe.provide("erpnext.utils");$.extend(erpnext,{get_currency:function(e){return!e&&cur_frm&&(e=cur_frm.doc.company),e&&frappe.get_doc(":Company",e).default_currency||frappe.boot.sysdefaults.currency},get_presentation_currency_list:()=>{let t=frappe.boot.docs.filter(i=>i.doctype===":Currency").map(i=>i.name);return t.unshift(""),t},toggle_naming_series:function(){cur_frm.fields_dict.naming_series&&cur_frm.toggle_display("naming_series",!!cur_frm.doc.__islocal)},hide_company:function(){if(cur_frm.fields_dict.company){var e=Object.keys(locals[":Company"]||{});e.length===1?(cur_frm.doc.company||cur_frm.set_value("company",e[0]),cur_frm.toggle_display("company",!1)):erpnext.last_selected_company&&(cur_frm.doc.company||cur_frm.set_value("company",erpnext.last_selected_company))}},is_perpetual_inventory_enabled:function(e){if(e)return frappe.get_doc(":Company",e).enable_perpetual_inventory},stale_rate_allowed:()=>cint(frappe.boot.sysdefaults.allow_stale),setup_serial_or_batch_no:function(){let e=cur_frm.open_grid_row();!e||!e.grid_form.fields_dict.serial_no||e.grid_form.fields_dict.serial_no.get_status()!=="Write"||frappe.model.get_value("Item",{name:e.doc.item_code},["has_serial_no","has_batch_no"],({has_serial_no:t,has_batch_no:i})=>{Object.assign(e.doc,{has_serial_no:t,has_batch_no:i}),t?p(__("Add Serial No"),e.grid_form.fields_dict.serial_no.$wrapper,this,e):i&&p(__("Pick Batch No"),e.grid_form.fields_dict.batch_no.$wrapper,this,e)})},route_to_adjustment_jv:e=>{frappe.model.with_doctype("Journal Entry",()=>{let t=frappe.model.get_new_doc("Journal Entry");e.accounts.forEach(i=>{let a=frappe.model.add_child(t,"accounts");a.account=i.account,a.debit_in_account_currency=i.debit_in_account_currency,a.credit_in_account_currency=i.credit_in_account_currency,a.party_type=""}),frappe.set_route("Form","Journal Entry",t.name)})},route_to_pending_reposts:e=>{frappe.set_route("List","Repost Item Valuation",e)}});$.extend(erpnext.utils,{set_party_dashboard_indicators:function(e){if(e.doc.__onload&&e.doc.__onload.dashboard_info){var t=e.doc.__onload.dashboard_info;t.length>1?t.forEach(function(i){erpnext.utils.add_indicator_for_multicompany(e,i)}):t.length===1&&(e.dashboard.add_indicator(__("Annual Billing: {0}",[format_currency(t[0].billing_this_year,t[0].currency)]),"blue"),e.dashboard.add_indicator(__("Total Unpaid: {0}",[format_currency(t[0].total_unpaid,t[0].currency)]),t[0].total_unpaid?"orange":"green"),t[0].loyalty_points&&e.dashboard.add_indicator(__("Loyalty Points: {0}",[t[0].loyalty_points]),"blue"))}},add_indicator_for_multicompany:function(e,t){e.dashboard.stats_area.show(),e.dashboard.stats_area_row.addClass("flex"),e.dashboard.stats_area_row.css("flex-wrap","wrap");var i=t.total_unpaid?"orange":"green",a=$('<div class="flex-column col-xs-6"><div style="margin-top:10px"><h6>'+t.company+'</h6></div><div class="badge-link small" style="margin-bottom:10px"><span class="indicator blue">Annual Billing: '+format_currency(t.billing_this_year,t.currency)+'</span></div><div class="badge-link small" style="margin-bottom:10px"><span class="indicator '+i+'">Total Unpaid: '+format_currency(t.total_unpaid,t.currency)+"</span></div></div>").appendTo(e.dashboard.stats_area_row);return t.loyalty_points&&$('<div class="badge-link small" style="margin-bottom:10px"><span class="indicator blue">Loyalty Points: '+t.loyalty_points+"</span></div>").appendTo(a),a},get_party_name:function(e){var t={Customer:"customer_name",Supplier:"supplier_name",Employee:"employee_name",Member:"member_name"};return t[e]},copy_value_in_all_rows:function(e,t,i,a,n){var o=locals[t][i];if(o[n])for(var l=e[a]||[],r=0;r<l.length;r++)l[r][n]||(l[r][n]=o[n]);refresh_field(a)},get_terms:function(e,t,i){if(e)return frappe.call({method:"erpnext.setup.doctype.terms_and_conditions.terms_and_conditions.get_terms_and_conditions",args:{template_name:e,doc:t},callback:function(a){i(a)}})},make_bank_account:function(e,t){frappe.call({method:"erpnext.accounts.doctype.bank_account.bank_account.make_bank_account",args:{doctype:e,docname:t},freeze:!0,callback:function(i){var a=frappe.model.sync(i.message);frappe.set_route("Form",a[0].doctype,a[0].name)}})},add_dimensions:function(e,t){let i=frappe.query_reports[e].filters;frappe.call({method:"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimensions",callback:function(a){a.message[0].forEach(o=>{i.some(r=>r.fieldname===o.fieldname)||i.splice(t,0,{fieldname:o.fieldname,label:__(o.label),fieldtype:"MultiSelectList",get_data:function(r){return frappe.db.get_link_options(o.document_type,r)}})})}})},add_inventory_dimensions:function(e,t){let i=frappe.query_reports[e].filters;frappe.call({method:"erpnext.stock.doctype.inventory_dimension.inventory_dimension.get_inventory_dimensions",callback:function(a){a.message&&a.message.length&&a.message.forEach(n=>{let o=i.filter(l=>l.fieldname===n.fieldname);o.length?(o[0].fieldtype="MultiSelectList",o[0].get_data=function(l){return frappe.db.get_link_options(n.doctype,l)}):i.splice(t,0,{fieldname:n.fieldname,label:__(n.doctype),fieldtype:"MultiSelectList",get_data:function(l){return frappe.db.get_link_options(n.doctype,l)}})})}})},make_subscription:function(e,t){frappe.call({method:"frappe.automation.doctype.auto_repeat.auto_repeat.make_auto_repeat",args:{doctype:e,docname:t},callback:function(i){var a=frappe.model.sync(i.message);frappe.set_route("Form",a[0].doctype,a[0].name)}})},make_pricing_rule:function(e,t){frappe.call({method:"erpnext.accounts.doctype.pricing_rule.pricing_rule.make_pricing_rule",args:{doctype:e,docname:t},callback:function(i){var a=frappe.model.sync(i.message);frappe.set_route("Form",a[0].doctype,a[0].name)}})},first_row_is_empty:function(e){return $.isArray(e)&&e.length>0?!e[0].item_code:!1},remove_empty_first_row:function(e,t){let i=e.doc[t];return this.first_row_is_empty(i)&&(e.doc[t]=i.splice(1)),i},get_tree_options:function(e){let t=frappe.model.unscrub(e),i=frappe.defaults.get_user_permissions(),a;return i&&i[t]?a=i[t].map(n=>n.doc):a=$.map(locals[`:${t}`],function(n){return n.name}).sort(),a.filter((n,o,l)=>l.indexOf(n)===o)},get_tree_default:function(e){let t=this.get_tree_options(e);return t.includes(frappe.defaults.get_default(e))?frappe.defaults.get_default(e):t[0]},overrides_parent_value_in_all_rows:function(e,t,i,a,n,o){if(e[o]){let l=e[a]||[];for(let r=0;r<l.length;r++)l[r][n]=e[o];frappe.refresh_field(a)}},create_new_doc:function(e,t){frappe.model.with_doctype(e,function(){var i=frappe.model.get_new_doc(e);for(let[a,n]of Object.entries(t))i[a]=n;frappe.ui.form.make_quick_entry(e,null,null,i)})},check_payments_app:()=>{if(frappe.boot.versions&&!frappe.boot.versions.payments){let e='<a href="https://frappecloud.com/marketplace/apps/payments">Marketplace</a>',t='<a href="https://github.com/frappe/payments/">GitHub</a>',i=__("payments app is not installed. Please install it from {0} or {1}",[e,t]);frappe.msgprint(i)}}});erpnext.utils.select_alternate_items=function(e){let t=e.frm,i=e.warehouse_field||"warehouse",a=e.item_field||"item_code";this.data=[];let n=new frappe.ui.Dialog({title:__("Select Alternate Item"),fields:[{fieldtype:"Section Break",label:__("Items")},{fieldname:"alternative_items",fieldtype:"Table",cannot_add_rows:!0,in_place_edit:!0,data:this.data,get_data:()=>this.data,fields:[{fieldtype:"Data",fieldname:"docname",hidden:1},{fieldtype:"Link",fieldname:"item_code",options:"Item",in_list_view:1,read_only:1,label:__("Item Code")},{fieldtype:"Link",fieldname:"alternate_item",options:"Item",default:"",in_list_view:1,label:__("Alternate Item"),onchange:function(){let o=this.get_value(),l=this.grid_row.on_grid_fields_dict.warehouse.get_value();o&&l&&frappe.call({method:"erpnext.stock.utils.get_latest_stock_qty",args:{item_code:o,warehouse:l},callback:r=>{this.grid_row.on_grid_fields_dict.actual_qty.set_value(r.message||0)}})},get_query:o=>({query:"erpnext.stock.doctype.item_alternative.item_alternative.get_alternative_items",filters:{item_code:o.item_code}})},{fieldtype:"Link",fieldname:"warehouse",options:"Warehouse",default:"",in_list_view:1,label:__("Warehouse"),onchange:function(){let o=this.get_value(),l=this.grid_row.on_grid_fields_dict.item_code.get_value();l&&o&&frappe.call({method:"erpnext.stock.utils.get_latest_stock_qty",args:{item_code:l,warehouse:o},callback:r=>{this.grid_row.on_grid_fields_dict.actual_qty.set_value(r.message||0)}})}},{fieldtype:"Float",fieldname:"actual_qty",default:0,read_only:1,in_list_view:1,label:__("Available Qty")}]}],primary_action:function(){this.get_values().alternative_items.filter(r=>{if(r.alternate_item&&r.item_code!=r.alternate_item)return!0}).forEach(r=>{let c=frappe.get_doc(e.child_doctype,r.docname),s=null;c.doctype==="Work Order Item"?s=c.required_qty:s=c.qty,c[a]=r.alternate_item,frappe.model.set_value(c.doctype,c.name,"qty",s),frappe.model.set_value(c.doctype,c.name,e.original_item_field,r.item_code),t.trigger(a,c.doctype,c.name)}),refresh_field(e.child_docname),this.hide()},primary_action_label:__("Update")});t.doc[e.child_docname].forEach(o=>{(!e.condition||e.condition(o))&&n.fields_dict.alternative_items.df.data.push({docname:o.name,item_code:o[a],warehouse:o[i],actual_qty:o.actual_qty})}),this.data=n.fields_dict.alternative_items.df.data,n.fields_dict.alternative_items.grid.refresh(),n.show()};erpnext.utils.update_child_items=function(e){let t=e.frm,i=typeof e.cannot_add_row=="undefined"?!0:e.cannot_add_row,a=typeof e.cannot_add_row=="undefined"?"items":e.child_docname,n=frappe.get_meta(`${t.doc.doctype} Item`),o=r=>n.fields.find(c=>c.fieldname==r).precision;this.data=t.doc[e.child_docname].map(r=>({docname:r.name,name:r.name,item_code:r.item_code,delivery_date:r.delivery_date,schedule_date:r.schedule_date,conversion_factor:r.conversion_factor,qty:r.qty,rate:r.rate,uom:r.uom,pack_size:r.pack_size,quantity_ltr_kg:r.quantity_ltr_kg,price_per_lt_or_kg:r.price_per_lt_or_kg}));let l=[{fieldtype:"Data",fieldname:"docname",read_only:1,hidden:1},{fieldtype:"Link",fieldname:"item_code",options:"Item",in_list_view:1,read_only:0,disabled:0,label:__("Item Code"),get_query:function(){let r;return t.doc.doctype=="Sales Order"?r={is_sales_item:1}:t.doc.doctype=="Purchase Order"&&(t.doc.is_subcontracted?t.doc.is_old_subcontracting_flow?r={is_sub_contracted_item:1}:r={is_stock_item:0}:r={is_purchase_item:1}),{query:"erpnext.controllers.queries.item_query",filters:r}}},{fieldtype:"Link",fieldname:"uom",options:"UOM",read_only:0,label:__("UOM"),reqd:1,onchange:function(){frappe.call({method:"erpnext.stock.get_item_details.get_conversion_factor",args:{item_code:this.doc.item_code,uom:this.value},callback:r=>{if(!r.exc){if(this.doc.conversion_factor==r.message.conversion_factor)return;let c=this.doc.docname;dialog.fields_dict.trans_items.df.data.some(s=>{if(s.docname==c)return s.conversion_factor=r.message.conversion_factor,dialog.fields_dict.trans_items.grid.refresh(),!0})}}})}},{fieldtype:"Float",fieldname:"qty",default:0,read_only:0,in_list_view:1,label:__("Qty"),precision:o("qty")},{fieldtype:"Currency",fieldname:"rate",options:"currency",default:0,read_only:0,in_list_view:1,label:__("Rate"),precision:o("rate")},{fieldtype:"Data",fieldname:"pack_size",default:0,read_only:1,in_list_view:1,label:__("Pack Size")},{fieldtype:"Currency",fieldname:"price_per_lt_or_kg",default:0,read_only:1,in_list_view:1,label:__("Price Per Lt or Kg")},{fieldtype:"Float",fieldname:"quantity_ltr_kg",default:0,read_only:1,in_list_view:1,label:__("Quantity Ltr Kg")}];(t.doc.doctype=="Sales Order"||t.doc.doctype=="Purchase Order")&&(l.splice(2,0,{fieldtype:"Date",fieldname:t.doc.doctype=="Sales Order"?"delivery_date":"schedule_date",in_list_view:1,label:t.doc.doctype=="Sales Order"?__("Delivery Date"):__("Reqd by date"),reqd:1}),l.splice(3,0,{fieldtype:"Float",fieldname:"conversion_factor",in_list_view:1,label:__("Conversion Factor"),precision:o("conversion_factor")})),new frappe.ui.Dialog({title:__("Update Items"),fields:[{fieldname:"trans_items",fieldtype:"Table",label:"Items",cannot_add_rows:i,in_place_edit:!1,reqd:1,data:this.data,get_data:()=>this.data,fields:l}],primary_action:function(){let r=this.get_values().trans_items.filter(c=>!!c.item_code);frappe.call({method:"coatserve.coatserve.update_child_qty_rate",freeze:!0,args:{parent_doctype:t.doc.doctype,trans_items:r,parent_doctype_name:t.doc.name,child_docname:a},callback:function(){t.reload_doc()}}),this.hide(),refresh_field("items")},primary_action_label:__("Update")}).show()};erpnext.utils.map_current_doc=function(e){function t(){if($.isArray(cur_frm.doc.items)&&cur_frm.doc.items.length>0){cur_frm.doc.items[0].item_code||(cur_frm.doc.items=cur_frm.doc.items.splice(1));var a=frappe.meta.get_docfield(cur_frm.doctype,"items").options,n=null;frappe.get_meta(a).fields.forEach(function(r){r.options===e.source_doctype&&(n=r.fieldname)});var o=!1,l={};$.each(cur_frm.doc.items,function(r,c){e.source_name.forEach(function(s){c[n]==s&&(o=!0,l[c.item_code]?l[c.item_code]+=flt(c.qty):l[c.item_code]=flt(c.qty))})}),o&&e.source_name.forEach(function(r){if(frappe.model.with_doc(e.source_doctype,r,function(c){var s=frappe.model.get_doc(e.source_doctype,r);$.each(s.items||[],function(m,_){if(_.qty>flt(l[_.item_code]))return o=!1,!1})}),o){frappe.msgprint(__("You have already selected items from {0} {1}",[e.source_doctype,r]));return}})}return frappe.call({type:"POST",method:"frappe.model.mapper.map_docs",args:{method:e.method,source_names:e.source_name,target_doc:cur_frm.doc,args:e.args},callback:function(r){if(!r.exc){var c=frappe.model.sync(r.message);cur_frm.dirty(),cur_frm.refresh()}}})}let i={};if(e.get_query_filters&&(i.filters=e.get_query_filters),e.get_query_method&&(i.query=e.get_query_method),(i.filters||i.query)&&(e.get_query=()=>i),e.source_doctype){let a=new frappe.ui.form.MultiSelectDialog({doctype:e.source_doctype,target:e.target,date_field:e.date_field||void 0,setters:e.setters,get_query:e.get_query,add_filters_group:1,allow_child_item_selection:e.allow_child_item_selection,child_fieldname:e.child_fieldname,child_columns:e.child_columns,size:e.size,action:function(n,o){let l=n;if(l.length===0){frappe.msgprint(__("Please select {0}",[e.source_doctype]));return}e.source_name=l,e.allow_child_item_selection&&(e.args=o),a.dialog.hide(),t()}});return a}e.source_name&&(e.source_name=[e.source_name],t())};frappe.form.link_formatters.Item=function(e,t){return t&&e&&t.item_name&&t.item_name!==e&&t.item_code===e?e+": "+t.item_name:!e&&t.doctype&&t.item_name?t.item_name:e};frappe.form.link_formatters.Employee=function(e,t){return t&&e&&t.employee_name&&t.employee_name!==e&&t.employee===e?e+": "+t.employee_name:!e&&t.doctype&&t.employee_name?t.employee:e};frappe.form.link_formatters.Project=function(e,t){return t&&e&&t.project_name&&t.project_name!==e&&t.project===e?e+": "+t.project_name:!e&&t.doctype&&t.project_name?t.project:e};$(document).on("app_ready",function(){frappe.datetime.is_timezone_same()||$.each(["Stock Reconciliation","Stock Entry","Stock Ledger Entry","Delivery Note","Purchase Receipt","Sales Invoice"],function(e,t){frappe.ui.form.on(t,"onload",function(i){cur_frm.set_df_property("posting_time","description",frappe.sys_defaults.time_zone)})})});$(document).on("app_ready",function(){frappe.call({method:"erpnext.support.doctype.service_level_agreement.service_level_agreement.get_sla_doctypes",callback:function(e){!e.message||$.each(e.message,function(t,i){frappe.ui.form.on(i,{onload:function(a){!a.doc.service_level_agreement||frappe.call({method:"erpnext.support.doctype.service_level_agreement.service_level_agreement.get_service_level_agreement_filters",args:{doctype:a.doc.doctype,name:a.doc.service_level_agreement,customer:a.doc.customer},callback:function(n){n&&n.message&&(a.set_query("priority",function(){return{filters:{name:["in",n.message.priority]}}}),a.set_query("service_level_agreement",function(){return{filters:{name:["in",n.message.service_level_agreements]}}}))}})},refresh:function(a){if(a.doc.status!=="Closed"&&a.doc.service_level_agreement&&["First Response Due","Resolution Due"].includes(a.doc.agreement_status))frappe.call({method:"frappe.client.get",args:{doctype:"Service Level Agreement",name:a.doc.service_level_agreement},callback:function(n){let o=n.message.pause_sla_on,l=[];if($.each(o,(r,c)=>{l.push(c.status)}),l.includes(a.doc.status)){a.dashboard.clear_headline();let r={indicator:"orange",msg:__("SLA is on hold since {0}",[moment(a.doc.on_hold_since).fromNow(!0)])};a.dashboard.set_headline_alert('<div class="row"><div class="col-xs-12"><span class="indicator whitespace-nowrap '+r.indicator+'"><span>'+r.msg+"</span></span> </div></div>")}else u(a,n.message.apply_sla_for_resolution)}});else if(a.doc.service_level_agreement){a.dashboard.clear_headline();let n=a.doc.agreement_status=="Fulfilled"?{indicator:"green",msg:"Service Level Agreement has been fulfilled"}:{indicator:"red",msg:"Service Level Agreement Failed"};a.dashboard.set_headline_alert('<div class="row"><div class="col-xs-12"><span class="indicator whitespace-nowrap '+n.indicator+'"><span class="hidden-xs">'+n.msg+"</span></span> </div></div>")}}})})}})});function u(e,t){e.dashboard.clear_headline();let i;e.doc.first_responded_on?i=f(e.doc.response_by,e.doc.first_responded_on):i=d(e.doc.response_by,e.doc.agreement_status);let a=`
		<div class="row">
			<div class="col-xs-12 col-sm-6">
				<span class="indicator whitespace-nowrap ${i.indicator}">
					<span>Time to Respond: ${i.diff_display}</span>
				</span>
			</div>`;if(t){let n;e.doc.resolution_date?n=f(e.doc.resolution_by,e.doc.resolution_date):n=d(e.doc.resolution_by,e.doc.agreement_status),a+=`
			<div class="col-xs-12 col-sm-6">
				<span class="indicator whitespace-nowrap ${n.indicator}">
					<span>Time to Resolve: ${n.diff_display}</span>
				</span>
			</div>`}a+="</div>",e.dashboard.set_headline_alert(a)}function d(e,t){let i=moment(e).diff(moment()),a=i>=44500?moment.duration(i).humanize():"Failed",n=a=="Failed"&&t!="Fulfilled"?"red":"green";return{diff_display:a,indicator:n}}function f(e,t){return moment(e).diff(moment(t))>=0?{diff_display:"Fulfilled",indicator:"green"}:{diff_display:"Failed",indicator:"red"}}function p(e,t,i,a){let n=$("<div>").css({"margin-bottom":"10px","margin-top":"10px"}).appendTo(t);$(`<button class="btn btn-sm btn-default">${e}</button>`).appendTo(n).on("click",function(){i.show_serial_batch_selector(a.frm,a.doc,"","",!0)})}})();
//# sourceMappingURL=coatserve.bundle.NG6XTXTM.js.map
